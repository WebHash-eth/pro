"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { Button } from "@/components/ui/button";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { signIn, signOut, useSession } from "next-auth/react";
import { ThemeToggle } from "@/app/components/theme-toggle";

export function Navbar() {
  const pathname = usePathname();
  const { data: session, status } = useSession();
  const isAuthenticated = status === "authenticated";

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 items-center">
        <div className="mr-4 flex">
          <Link href="/" className="mr-6 flex items-center space-x-2">
            <svg width="120" height="25" viewBox="0 0 608 126" className="w-[120px] h-[25px]" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M37.2311 36.0068H25.202L20.5781 51.4609H32.6071L37.2311 36.0068Z" fill="currentColor"/>
              <path d="M43.0673 53.7131H0V65.7422H39.4679L43.0673 53.7131Z" fill="currentColor"/>
              <path d="M59.5107 53.7131L55.9121 65.7422H67.9075V53.7131H59.5107Z" fill="currentColor"/>
              <path d="M51.7342 72.1992L62.5637 36.0008H50.5353L39.7051 72.1992H51.7342Z" fill="currentColor"/>
              <path d="M30.1465 104.035H42.1756L46.7995 88.581H34.7704L30.1465 104.035Z" fill="currentColor"/>
              <path d="M11.507 74.4318H0V86.4609H7.90821L11.507 74.4318Z" fill="currentColor"/>
              <path d="M24.4453 86.4609H68.0001V74.4318H28.0439L24.4453 86.4609Z" fill="currentColor"/>
              <path d="M15.7425 67.8367L4.91211 104.035H16.9412L27.7712 67.8367H15.7425Z" fill="currentColor"/>
              <rect x="491" y="36" width="117" height="67" rx="10" fill="currentColor"/>
              <path d="M102.7 100L84.6 51.7H97.8L109.6 86.8L105.6 86.9L117.7 51.7H127.2L139.3 86.9L135.3 86.8L147.1 51.7H160.3L142.3 100H132.8L120.6 66.6H124.3L112.1 100H102.7ZM185.681 101C180.615 101 176.115 99.9333 172.181 97.8C168.248 95.6 165.115 92.6 162.781 88.8C160.515 85 159.381 80.6667 159.381 75.8C159.381 71 160.481 66.7333 162.681 63C164.948 59.2 168.015 56.2 171.881 54C175.748 51.7333 180.048 50.6 184.781 50.6C189.448 50.6 193.548 51.6667 197.081 53.8C200.681 55.8667 203.481 58.7333 205.481 62.4C207.548 66 208.581 70.1 208.581 74.7C208.581 75.5667 208.515 76.4667 208.381 77.4C208.315 78.2667 208.148 79.2667 207.881 80.4L167.281 80.5V70.7L201.781 70.6L196.481 74.7C196.348 71.8333 195.815 69.4333 194.881 67.5C194.015 65.5667 192.715 64.1 190.981 63.1C189.315 62.0333 187.248 61.5 184.781 61.5C182.181 61.5 179.915 62.1 177.981 63.3C176.048 64.4333 174.548 66.0667 173.481 68.2C172.481 70.2667 171.981 72.7333 171.981 75.6C171.981 78.5333 172.515 81.1 173.581 83.3C174.715 85.4333 176.315 87.1 178.381 88.3C180.448 89.4333 182.848 90 185.581 90C188.048 90 190.281 89.6 192.281 88.8C194.281 87.9333 196.015 86.6667 197.481 85L205.181 92.7C202.848 95.4333 199.981 97.5 196.581 98.9C193.248 100.3 189.615 101 185.681 101ZM240.483 101C237.016 101 233.883 100.267 231.083 98.8C228.283 97.3333 226.049 95.3333 224.383 92.8C222.716 90.2667 221.816 87.4333 221.683 84.3V67.1C221.816 63.9667 222.716 61.1667 224.383 58.7C226.116 56.1667 228.383 54.2 231.183 52.8C233.983 51.4 237.083 50.7 240.483 50.7C244.949 50.7 248.949 51.8 252.483 54C256.016 56.2 258.783 59.2 260.783 63C262.849 66.8 263.883 71.1 263.883 75.9C263.883 80.6333 262.849 84.9 260.783 88.7C258.783 92.5 256.016 95.5 252.483 97.7C248.949 99.9 244.949 101 240.483 101ZM213.683 100V27.7H226.783V100H213.683ZM238.283 88.9C240.683 88.9 242.783 88.3667 244.583 87.3C246.449 86.1667 247.883 84.6333 248.883 82.7C249.949 80.7 250.483 78.4 250.483 75.8C250.483 73.2667 249.949 71.0333 248.883 69.1C247.883 67.1 246.449 65.5667 244.583 64.5C242.716 63.3667 240.583 62.8 238.183 62.8C235.783 62.8 233.649 63.3667 231.783 64.5C229.983 65.5667 228.549 67.1 227.483 69.1C226.483 71.0333 225.983 73.2667 225.983 75.8C225.983 78.4 226.483 80.7 227.483 82.7C228.549 84.6333 230.016 86.1667 231.883 87.3C233.749 88.3667 235.883 88.9 238.283 88.9ZM301.972 100V72.3C301.972 69.4333 301.072 67.1 299.272 65.3C297.472 63.5 295.139 62.6 292.272 62.6C290.405 62.6 288.739 63 287.272 63.8C285.805 64.6 284.639 65.7333 283.772 67.2C282.972 68.6667 282.572 70.3667 282.572 72.3L277.472 69.7C277.472 65.9 278.272 62.6 279.872 59.8C281.472 56.9333 283.672 54.7 286.472 53.1C289.339 51.5 292.605 50.7 296.272 50.7C299.939 50.7 303.172 51.5 305.972 53.1C308.839 54.7 311.072 56.9 312.672 59.7C314.272 62.5 315.072 65.7333 315.072 69.4V100H301.972ZM269.472 100V27.7H282.572V100H269.472ZM342.824 101C338.424 101 334.458 99.9 330.924 97.7C327.391 95.5 324.624 92.5 322.624 88.7C320.624 84.9 319.624 80.6333 319.624 75.9C319.624 71.1 320.624 66.8 322.624 63C324.624 59.2 327.391 56.2 330.924 54C334.458 51.8 338.424 50.7 342.824 50.7C346.291 50.7 349.391 51.4 352.124 52.8C354.858 54.2 357.024 56.1667 358.624 58.7C360.291 61.1667 361.191 63.9667 361.324 67.1V84.5C361.191 87.7 360.291 90.5333 358.624 93C357.024 95.4667 354.858 97.4333 352.124 98.9C349.391 100.3 346.291 101 342.824 101ZM345.224 88.9C348.891 88.9 351.858 87.7 354.124 85.3C356.391 82.8333 357.524 79.6667 357.524 75.8C357.524 73.2667 356.991 71.0333 355.924 69.1C354.924 67.1 353.491 65.5667 351.624 64.5C349.824 63.3667 347.691 62.8 345.224 62.8C342.824 62.8 340.691 63.3667 338.824 64.5C337.024 65.5667 335.591 67.1 334.524 69.1C333.524 71.0333 333.024 73.2667 333.024 75.8C333.024 78.4 333.524 80.7 334.524 82.7C335.591 84.6333 337.024 86.1667 338.824 87.3C340.691 88.3667 342.824 88.9 345.224 88.9ZM356.824 100V87L358.924 75.2L356.824 63.6V51.7H369.824V100H356.824ZM395.013 101.1C392.28 101.1 389.58 100.733 386.913 100C384.313 99.2667 381.913 98.2667 379.713 97C377.513 95.6667 375.613 94.0667 374.013 92.2L381.813 84.3C383.48 86.1667 385.413 87.5667 387.613 88.5C389.813 89.4333 392.247 89.9 394.913 89.9C397.047 89.9 398.647 89.6 399.713 89C400.847 88.4 401.413 87.5 401.413 86.3C401.413 84.9667 400.813 83.9333 399.613 83.2C398.48 82.4667 396.98 81.8667 395.113 81.4C393.247 80.8667 391.28 80.3 389.213 79.7C387.213 79.0333 385.28 78.2 383.413 77.2C381.547 76.1333 380.013 74.7 378.813 72.9C377.68 71.0333 377.113 68.6333 377.113 65.7C377.113 62.6333 377.847 59.9667 379.313 57.7C380.847 55.4333 383.013 53.6667 385.813 52.4C388.613 51.1333 391.913 50.5 395.713 50.5C399.713 50.5 403.313 51.2 406.513 52.6C409.78 54 412.48 56.1 414.613 58.9L406.713 66.8C405.247 65 403.58 63.7 401.713 62.9C399.913 62.1 397.947 61.7 395.813 61.7C393.88 61.7 392.38 62 391.313 62.6C390.313 63.2 389.813 64.0333 389.813 65.1C389.813 66.3 390.38 67.2333 391.513 67.9C392.713 68.5667 394.247 69.1667 396.113 69.7C397.98 70.1667 399.913 70.7333 401.913 71.4C403.98 72 405.913 72.8667 407.713 74C409.58 75.1333 411.08 76.6333 412.213 78.5C413.413 80.3667 414.013 82.7667 414.013 85.7C414.013 90.4333 412.313 94.2 408.913 97C405.513 99.7333 400.88 101.1 395.013 101.1ZM452.347 100V72.3C452.347 69.4333 451.447 67.1 449.647 65.3C447.847 63.5 445.514 62.6 442.647 62.6C440.78 62.6 439.114 63 437.647 63.8C436.18 64.6 435.014 65.7333 434.147 67.2C433.347 68.6667 432.947 70.3667 432.947 72.3L427.847 69.7C427.847 65.9 428.647 62.6 430.247 59.8C431.847 56.9333 434.047 54.7 436.847 53.1C439.714 51.5 442.98 50.7 446.647 50.7C450.314 50.7 453.547 51.5 456.347 53.1C459.214 54.7 461.447 56.9 463.047 59.7C464.647 62.5 465.447 65.7333 465.447 69.4V100H452.347ZM419.847 100V27.7H432.947V100H419.847Z" fill="currentColor"/>
              <path d="M515.46 74.645V68.54H524.425C525.598 68.54 526.662 68.3017 527.615 67.825C528.568 67.3483 529.32 66.67 529.87 65.79C530.42 64.8733 530.695 63.7733 530.695 62.49C530.695 61.2433 530.42 60.1617 529.87 59.245C529.32 58.3283 528.568 57.6317 527.615 57.155C526.662 56.6783 525.598 56.44 524.425 56.44H515.46V50.335H525.195C527.652 50.335 529.852 50.83 531.795 51.82C533.775 52.81 535.333 54.2217 536.47 56.055C537.607 57.8517 538.175 59.9967 538.175 62.49C538.175 64.9833 537.607 67.1467 536.47 68.98C535.333 70.7767 533.775 72.17 531.795 73.16C529.852 74.15 527.652 74.645 525.195 74.645H515.46ZM509.96 89V50.335H517.44V89H509.96ZM541.432 89V62.435H548.637V89H541.432ZM548.637 74.315L545.832 72.445C546.162 69.1817 547.115 66.615 548.692 64.745C550.268 62.8383 552.542 61.885 555.512 61.885C556.795 61.885 557.95 62.105 558.977 62.545C560.003 62.9483 560.938 63.6267 561.782 64.58L557.272 69.75C556.868 69.31 556.373 68.98 555.787 68.76C555.237 68.54 554.595 68.43 553.862 68.43C552.322 68.43 551.057 68.925 550.067 69.915C549.113 70.8683 548.637 72.335 548.637 74.315ZM574.396 89.55C571.719 89.55 569.299 88.945 567.136 87.735C565.009 86.4883 563.304 84.82 562.021 82.73C560.774 80.6033 560.151 78.2383 560.151 75.635C560.151 73.0317 560.774 70.7033 562.021 68.65C563.267 66.56 564.972 64.91 567.136 63.7C569.299 62.4533 571.701 61.83 574.341 61.83C577.054 61.83 579.474 62.4533 581.601 63.7C583.764 64.91 585.469 66.56 586.716 68.65C587.962 70.7033 588.586 73.0317 588.586 75.635C588.586 78.2383 587.962 80.6033 586.716 82.73C585.469 84.82 583.764 86.4883 581.601 87.735C579.474 88.945 577.072 89.55 574.396 89.55ZM574.341 82.84C575.697 82.84 576.889 82.5467 577.916 81.96C578.979 81.3367 579.786 80.4933 580.336 79.43C580.922 78.33 581.216 77.0833 581.216 75.69C581.216 74.2967 580.922 73.0683 580.336 72.005C579.749 70.9417 578.942 70.1167 577.916 69.53C576.889 68.9067 575.697 68.595 574.341 68.595C573.021 68.595 571.847 68.9067 570.821 69.53C569.794 70.1167 568.987 70.9417 568.401 72.005C567.814 73.0683 567.521 74.2967 567.521 75.69C567.521 77.0833 567.814 78.33 568.401 79.43C568.987 80.4933 569.794 81.3367 570.821 81.96C571.847 82.5467 573.021 82.84 574.341 82.84Z" fill="#000"/>
            </svg>
          </Link>
          <nav className="flex items-center space-x-6 text-sm font-medium">
            <Link
              href="/"
              className={`transition-colors hover:text-foreground/80 ${
                pathname === "/" ? "text-foreground" : "text-foreground/60"
              }`}
            >
              Home
            </Link>
            {isAuthenticated && (
              <Link
                href="/dashboard"
                className={`transition-colors hover:text-foreground/80 ${
                  pathname === "/dashboard"
                    ? "text-foreground"
                    : "text-foreground/60"
                }`}
              >
                Dashboard
              </Link>
            )}
          </nav>
        </div>
        <div className="ml-auto flex items-center space-x-4">
          <ThemeToggle />
          {isAuthenticated ? (
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button
                  variant="ghost"
                  className="relative h-8 w-8 rounded-full"
                >
                  <Avatar className="h-8 w-8">
                    <AvatarImage
                      src={session?.user?.image || ""}
                      alt={session?.user?.name || "User"}
                    />
                    <AvatarFallback>
                      {session?.user?.name
                        ?.split(" ")
                        .map((n) => n[0])
                        .join("")}
                    </AvatarFallback>
                  </Avatar>
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent className="w-56" align="end" forceMount>
                <DropdownMenuLabel className="font-normal">
                  <div className="flex flex-col space-y-1">
                    <p className="text-sm font-medium leading-none">
                      {session?.user?.name}
                    </p>
                    <p className="text-xs leading-none text-muted-foreground">
                      {session?.user?.email}
                    </p>
                  </div>
                </DropdownMenuLabel>
                <DropdownMenuSeparator />
                <DropdownMenuItem asChild>
                  <Link href="/dashboard">Dashboard</Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                  <Link href="/dashboard/deployments">Deployments</Link>
                </DropdownMenuItem>
                <DropdownMenuItem asChild>
                  <Link href="/dashboard/settings">Settings</Link>
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem
                  className="cursor-pointer"
                  onClick={() => signOut({ callbackUrl: "/", redirect: true })}
                >
                  Log out
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          ) : (
            <Button onClick={() => signIn("github", { callbackUrl: "/dashboard" })}>Sign In</Button>
          )}
        </div>
      </div>
    </header>
  );
} 